# Report Generator

This report generator fills a Word template using `docxtpl` and produces only the final `.docx` file under `out/`. It never touches the template styling and only replaces `{{...}}` tokens.

## Data flow

Production data is generated by the system (DB/API) and written into `report-data.json`, then the template is rendered into `out/*.docx`.

```
system data -> report-data.json -> template fill -> out/project-report.docx
```

## CLI usage

The generator supports two input modes:

- File mode: use an existing JSON file
- System mode: fetch data from the system (currently a stub that returns dummy data)

### File mode (local test)

```powershell
python tools/reportgen/generate_report.py `
  --template docs/templates/project-report-template.TEMPLATE.docx `
  --data docs/report-data.json `
  --out out/project-report.docx
```

### System mode (stub -> replace with real integration)

```powershell
python tools/reportgen/generate_report.py `
  --template docs/templates/project-report-template.TEMPLATE.docx `
  --source system `
  --project_id DEMO-PROJECT `
  --asof 2026-01-01 `
  --out out/project-report.docx
```

System mode is implemented in `tools/reportgen/report_data_adapter.py`. Replace the placeholder functions with DB/API calls:

- `get_project_summary`
- `get_financial_analysis`
- `get_risks`
- `get_opportunities`
- `get_monitoring_points`
- `get_news_insights`
- `get_final_opinion`

Each function currently returns dummy text with `TODO` comments showing the exact handoff point for real system integration.

## Template utilities

Scan template tokens:

```powershell
python tools/reportgen/generate_report.py --template docs/templates/project-report-template.TEMPLATE.docx --scan-only
```

Generate a JSON skeleton from template tokens (redirect to a file):

```powershell
python tools/reportgen/generate_report.py --template docs/templates/project-report-template.TEMPLATE.docx --init-json > docs/report-data.skeleton.json
```

## Automation examples

In production, invoke the generator from a scheduler or service (Cloud Functions, Batch, CI/CD) by calling `generate_report.py` with system mode:

```powershell
python tools/reportgen/generate_report.py --source system --project_id PROJECT-123 --asof 2026-01-01 --out out/project-report.docx
```
