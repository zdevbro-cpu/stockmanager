# 00_NORTH_STAR (실전투자용 설계 기준서)
- 작성일: 2026-01-08 10:00 (KST)
- 목적: “주식종목추천 + 타이밍 신호 + 분석보기 + VC 투자검토 리포트”를 **실전투자 운영 수준(Production-grade)** 으로 구축한다.
- 전제(확정): 코스피/코스닥, 단기 중심, Top N + 비중, 신호 발생 시 **수동 주문**, ETF/리츠는 확장 가능한 구조, VC 리포트는 **비상장 포함**.

---

## 1. 제품 목표(1문장)
KRX(코스피/코스닥) 종목을 대상으로 KRX/DART/ECOS/KIS 데이터를 결합하여 **재현 가능·검증 가능·감사 가능**한 방식으로
(1) 포트폴리오 추천(Top N+비중)과 (2) 진입/청산 타이밍 신호를 제공하고, (3) 근거 중심 분석보기와 (4) VC 투자심사 수준의 리포트를 생성한다.

---

## 2. 운영 원칙(Production-grade 원칙)
1) **재현성**: 어떤 날짜(as_of)에서 나온 추천/신호/리포트는 동일 입력이면 동일 결과가 나와야 한다. (전략/피처/모델 버전 고정)
2) **시점정합(Point-in-Time)**: DART/재무/이벤트는 “발표 시점” 이전 정보를 미래에 사용하지 않는다.
3) **설명가능성**: 추천/비중/신호에 대해 “왜?”를 데이터 기반으로 제시한다. (팩터 기여도, 필터/제약 통과, 리스크 플래그)
4) **보수적 리스크 관리**: 과도한 회전율/변동성/유동성 부족 종목을 억제한다. (제약/턴오버/최대비중/섹터 제한)
5) **감사 추적(Audit)**: 데이터 수집·가공·추천 생성·리포트 생성의 모든 실행 이력을 남긴다.
6) **안전장치**: 데이터 이상, 파이프라인 실패, 공시 이벤트 등 위험 상황에서 “진입 차단/비중 축소”가 기본값이 되도록 한다.
7) **수동주문 준수**: 본 시스템은 주문 실행을 자동화하지 않으며, “신호/가이드” 제공에 집중한다.

---

## 3. 범위(이번 버전: Production v1)
### 3.1 반드시 포함(핵심 기능)
A. 데이터 수집/정합
- KRX: 상장종목/시장/섹터/기본정보, (가능하면) 거래정지/관리종목 플래그
- DART: 공시 메타 + 재무(발표시점 포함), 정정/추가 공시 반영
- ECOS: 거시 시계열(코드 관리 + 변환)
- KIS: 일봉 가격/거래량/거래대금(최소), (가능하면) 기업기초/지표 일부

B. 추천(Top N + 비중)
- 유니버스 필터(가격/상장일수/유동성) + 점수 산출(팩터 가중치)
- 비중 산출(최대 종목/섹터, 변동성 타겟팅, 턴오버 제한)
- 추천 결과 DB 저장 + API 제공

C. 타이밍(수동주문 보조)
- 룰 기반 신호(최소 3~5개 룰): BUY/WAIT/REDUCE/SELL
- 이벤트 리스크 정책(기본: 진입 차단 또는 비중 축소)

D. 분석보기(Explainability)
- 추천/신호의 근거: 팩터 기여도, 필터/제약, 리스크 플래그, 주요 차트/지표
- “왜 이 비중인가/왜 WAIT인가”가 1스크린에서 확인 가능

E. 리포트(투자심사 수준)
- 상장: DART/가격/거시 근거 포함 “investment_memo_vc_v1” 최소 1종
- 비상장: 입력폼 + 파일업로드(피치덱/재무엑셀/IR자료) 기반 RAG 요약 + 근거 링크(문서/청크)

F. 백테스트/검증
- PIT 준수 백테스트(최소 일봉): 비용모델(수수료/세금/슬리피지) 포함
- 기본 성과지표 + 턴오버/최대낙폭(MDD) 산출

G. 운영/품질
- 스케줄(장마감 배치) + 재시도/멱등성(idempotency)
- 데이터 검증(누락/이상치/시점오류) + 알람
- 로깅/모니터링/에러 추적
- 권한(최소 RBAC) + 시크릿 관리

### 3.2 이번엔 하지 않음(비목표 / 드리프트 방지)
- 실주문 자동화(자동매매), 계좌 연동 주문 실행
- 초단타/분봉 기반 HFT
- 레버리지/파생/해외주식(확장 전제로 구조만)
- “의견형 커뮤니티/소셜 트레이딩”
- 대규모 ML(딥러닝) 먼저 도입(→ v2에서 옵션)

---

## 4. 성공 기준(Definition of Done: Production v1)
1) 특정 as_of_date에 대해 추천 Top N+비중이 **DB에 저장**되고 API로 재현 가능
2) 추천 1개 종목을 클릭하면 분석보기에서 “점수/팩터 기여/제약/리스크/차트/이벤트”가 표시됨
3) 타이밍 신호가 생성되고(룰 기반) 신뢰도/트리거/리스크 플래그를 제공
4) 상장 리포트 1종과 비상장 리포트 1종(입력+업로드 기반)이 생성되고 **근거 링크(문서/청크)** 가 남음
5) 백테스트가 PIT 준수로 실행되며, 주요 지표(수익률/변동성/MDD/턴오버)가 산출됨
6) 배치 실패/데이터 누락 시 알람이 발생하고, 재시도 후에도 실패하면 “추천 생성 차단” 등 안전장치가 작동

---

## 5. 권장 기술 스택(현재 사용 패턴 유지 + 운영성 강화)
### Frontend
- Vite + React + TypeScript
- Tailwind CSS
- TanStack Query(서버 상태), Zod(입력 검증), Recharts(차트)

### Backend/API
- Python 3.11+
- FastAPI + Pydantic v2
- SQLAlchemy 2.x + Alembic(마이그레이션)
- httpx(외부 API), pandas/numpy(피처 계산)

### Infra(GCP/Firebase 중심)
- Firebase Hosting(프론트)
- Firebase Auth(인증) + 백엔드 JWT 검증
- Cloud Run: api 서비스 / worker(배치) / ingest(수집)
- Cloud Scheduler: 장마감 배치 트리거
- Pub/Sub 또는 Cloud Tasks: 비동기 작업 큐(리포트 생성/인제스트)
- Cloud Storage: 원문/산출물 저장
- Cloud SQL(PostgreSQL): 메인 DB
  - (선택) pgvector: RAG 임베딩을 Postgres에 유지하고 싶을 때

### 운영/보안
- Secret Manager(키/토큰)
- Cloud Logging/Monitoring + Error Reporting
- (선택) Sentry(프론트/백엔드 에러 추적)

---

## 6. 파일/계약(변경 통제)
- openapi_v2.1.yaml: API 계약(변경은 PR+리뷰로만)
- strategy-definition-schema-v2.1.0.json: 전략 계약(호환성 유지)
- postgres_erd_ddl_v2.1.sql: DB 계약(변경은 migration으로만)
